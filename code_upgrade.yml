---
#- name: Run Backup first
  import_playbook: backup.yml

- name: Firmware upgrade workflow
  hosts: all
  gather_facts: no
  connection: network_cli
  
  pre_tasks:
    - name: Verify file md5
      import_tasks: tasks/t_md5_cal.yml
      register: md5_output
      
    - name: Compare with official MD5
      import_tasks: tasks/t_md5_check.yml

  tasks:
    - name: Upgrade standalone devices
      block:
#        - name: Install
#          import_tasks: tasks/t_patch.yml
#          
#        - name: print install result
#          debug: 
#            msg: "{{  install_output  }}"

        - name: Waiting For {{ ansible_network_hostname }} To Come Back Up     
          wait_for:
            host: "{{ inventory_hostname }}"
            port: 22
            state: started
            timeout: 300
            delay: 60  
            
#        - name: confirm standalone upgrade is complete
#          import_tasks: tasks/t_patch_confirm.yml
          
      when: patch_tag == "standalone"
